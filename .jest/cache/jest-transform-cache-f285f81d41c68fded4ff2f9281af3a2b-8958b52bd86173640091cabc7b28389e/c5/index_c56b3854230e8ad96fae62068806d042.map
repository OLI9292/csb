{"version":3,"sources":["index.tsx"],"names":[],"mappings":";;;;;;;;;;AAAA,8B;AAEA;AAEA,kC;AACA,kC;AACA,oC;AACA,wC;AAgBA,IAAA,WAAA,aAAA,UAAA,MAAA,EAAA;AAAsC,cAAA,QAAA,EAAA,MAAA;AAKpC,aAAA,QAAA,CAAY,KAAZ,EAAwB;AAAxB,YAAA,QACE,OAAA,IAAA,CAAA,IAAA,EAAM,KAAN,KAAY,IADd;AAGE,cAAK,KAAL,GAAa;AACX,0BAAc,KADH;AAEX,mBAAO,CAFI;AAGX,yBAAa,EAHF;AAIX,8BAAkB,IAAI,sBAAS,KAAb,CAAmB,CAAnB,CAJP,EAAb;;AAOA,cAAK,eAAL,GAAuB,gBAAM,SAAN,EAAvB;AACA,cAAK,gBAAL,GAAwB,gBAAM,SAAN,EAAxB;;AACD;AAED,aAAA,SAAA,CAAA,iBAAA,GAAA,YAAA;AACE,aAAK,KAAL,CAAW,KAAK,KAAL,CAAW,QAAtB;AACD,KAFD;AAIA,aAAA,SAAA,CAAA,yBAAA,GAAA,UAA0B,SAA1B,EAA0C;AAA1C,YAAA,QAAA,IAAA;AACE,YAAI,UAAU,QAAV,IAAsB,KAAK,KAAL,CAAW,QAAX,KAAwB,UAAU,QAA5D,EAAsE;AACpE,kCAAS,MAAT,CAAgB,KAAK,KAAL,CAAW,gBAA3B,EAA6C,EAAE,SAAS,CAAX,EAAc,UAAU,GAAxB,EAA7C,EAA4E,KAA5E;AACA,iBAAK,mBAAL,GAA2B,WAAW,YAAA;AACpC,sBAAK,KAAL,CAAW,UAAU,QAArB;AACA,sCAAS,MAAT,CAAgB,MAAK,KAAL,CAAW,gBAA3B,EAA6C,EAAE,SAAS,CAAX,EAAc,UAAU,GAAxB,EAA7C,EAA4E,KAA5E;AACD,aAH0B,EAGxB,GAHwB,CAA3B;AAID;AACF,KARD;AAUA,aAAA,SAAA,CAAA,KAAA,GAAA,UAAM,QAAN,EAAmB;AACjB,aAAK,QAAL,CAAc;AACZ,sBAAU,QADE;AAEZ,mBAAO,CAFK;AAGZ,0BAAc,KAHF;AAIZ,yBAAa,EAJD,EAAd;;AAMD,KAPD;AAWA,aAAA,SAAA,CAAA,OAAA,GAAA,UAAQ,SAAR,EAA+B,KAA/B,EAA4C;AACtC,YAAA,KAAA,KAAA,KAAA,CACF,cAAA,GAAA,WADE,CAEF,WAAA,GAAA,QAFE,CAGF,eAAA,GAAA,YAHE;AAMJ,oBAAY,KAAZ,IAAqB,SAArB;AACA,aAAK,QAAL,CAAc,EAAE,aAAW,WAAb,EAAd;AACA,gBAAQ,QAAQ,CAAhB;AAEA,uBAAe,gBAAiB,UAAU,SAAS,OAAT,CAAiB,MAA3D;AACA,YAAI,YAAJ,EAAkB;AAAE,iBAAK,QAAL,CAAc,EAAE,cAAY,YAAd,EAAd;AAAiC;AAErD,YAAM,OAAO,qBAAE,KAAF,CAAQ,WAAR,EAAqB,UAAA,CAAA,EAAC,CAAI,OAAA,EAAA,OAAA,CAAS,CAAnC;AACX,oBAAY,MAAZ,KAAuB,SAAS,OAAT,CAAiB,MAD1C;AAGA,YAAI,IAAJ,EAAU;AACR,iBAAK,KAAL,CAAW,YAAX;AACD,SAFD;AAEO;AACL,gBAAI,YAAJ,EAAkB;AAChB,oBAAM,iBAAiB,qBAAE,SAAF,CAAY,WAAZ,EAAyB,UAAA,CAAA,EAAC,CAAI,OAAA,CAAC,EAAD,OAAA,CAAU,CAAxC,CAAvB;AACA,oBAAI,iBAAiB,CAAC,CAAtB,EAAyB;AAAE,yBAAK,QAAL,CAAc,EAAE,OAAO,cAAT,EAAd;AAA0C;AACtE,aAHD;AAGO;AACL,qBAAK,QAAL,CAAc,EAAE,OAAK,KAAP,EAAd;AACD;AACF;AACF,KA3BD;AA6BA,aAAA,SAAA,CAAA,MAAA,GAAA,YAAA;AACE,YAAI,CAAC,KAAK,KAAL,CAAW,QAAhB,EAA0B;AACxB,mBAAO,IAAP;AACD;AAEK,YAAA,KAAA,KAAA,KAAA,CACJ,QAAA,GAAA,KADI,CAEJ,cAAA,GAAA,WAFI,CAGJ,WAAA,GAAA,QAHI,CAIJ,eAAA,GAAA,YAJI;AAON,eACE,gBAAA,aAAA,CAAC,sBAAS,IAAV,EAAc,EAAC,OAAO,CAAC,EAAE,SAAS,KAAK,KAAL,CAAW,gBAAtB,EAAwC,MAAM,CAA9C,EAAiD,WAAW,SAA5D,EAAD,CAAR,EAAd;AACE,wBAAA,aAAA,CAAC,gBAAD,EAAO,EACL,KAAK,KAAK,eADL,EAEL,QAAQ,SAAS,MAFZ,EAGL,iBAAiB,SAAS,eAHrB,EAAP,CADF;AAME,wBAAA,aAAA,CAAC,gBAAD,EAAO,EACL,cAAc,YADT,EAEL,OAAO,KAFF,EAGL,SAAS,SAAS,OAHb,EAIL,aAAa,WAJR,EAAP,CANF;AAYE,wBAAA,aAAA,CAAC,iBAAD,EAAQ,EACN,aAAa,KAAK,KAAL,CAAW,WADlB,EAEN,KAAK,KAAK,gBAFJ,EAGN,OAAO,KAHD,EAIN,MAAM,SAAS,OAJT,EAKN,SAAS,KAAK,OAAL,CAAa,IAAb,CAAkB,IAAlB,CALH,EAAR,CAZF,CADF;AAqBD,KAjCD;AAkCF,WAAA,QAAA;AAAC,CA3GD,CAAsC,gBAAM,SAA5C,CAAA,C","sourcesContent":["import React from 'react'\nimport styled from \"styled-components\"\nimport { Animated } from \"react-native\"\n\nimport Prompt from './prompt'\nimport Answer, { UserAnswer } from './answer'\nimport Choices from './choices'\nimport _ from \"underscore\"\n\nexport interface Props {\n  question: any,\n  questionDone: () => void,\n  isInterlude: boolean\n}\n\ninterface State {\n  question?: any,\n  opacityAnimation: Animated.Value,\n  userAnswers: UserAnswer[],\n  layer: number,\n  isCorrecting: boolean\n}\n\nexport default class Question extends React.Component<Props, State> {\n  private choicesComponent: React.RefObject<Choices>\n  private promptComponent: React.RefObject<Prompt>\n  private nextQuestionTimeout: any\n\n  constructor(props: Props) {\n    super(props)\n\n    this.state = {\n      isCorrecting: false,\n      layer: 0,\n      userAnswers: [],\n      opacityAnimation: new Animated.Value(1)\n    }\n\n    this.promptComponent = React.createRef()\n    this.choicesComponent = React.createRef()\n  }\n\n  componentDidMount() {\n    this.reset(this.props.question)\n  }\n\n  componentWillReceiveProps(nextProps: Props) {\n    if (nextProps.question && this.props.question !== nextProps.question) {\n      Animated.timing(this.state.opacityAnimation, { toValue: 0, duration: 500 }).start()\n      this.nextQuestionTimeout = setTimeout(() => {  \n        this.reset(nextProps.question)\n        Animated.timing(this.state.opacityAnimation, { toValue: 1, duration: 500 }).start()\n      }, 500)\n    }\n  }\n\n  reset(question: any) {\n    this.setState({\n      question: question,\n      layer: 0,\n      isCorrecting: false,\n      userAnswers: []\n    })\n  }\n\n  \n\n  guessed(userAnwer: UserAnswer, layer: number) {  \n    let {\n      userAnswers,\n      question,\n      isCorrecting\n    } = this.state\n\n    userAnswers[layer] = userAnwer\n    this.setState({ userAnswers })\n    layer = layer + 1\n    \n    isCorrecting = isCorrecting ||  layer === question.choices.length\n    if (isCorrecting) { this.setState({ isCorrecting }) }\n\n    const done = _.every(userAnswers, a => a.correct) &&\n      userAnswers.length === question.choices.length\n\n    if (done) {\n      this.props.questionDone()\n    } else {\n      if (isCorrecting) {\n        const incorrectLayer = _.findIndex(userAnswers, u => !u.correct)\n        if (incorrectLayer > -1) { this.setState({ layer: incorrectLayer }) }\n      } else {\n        this.setState({ layer })\n      }\n    }\n  }\n\n  render() {\n    if (!this.state.question) { \n      return null\n    }\n    \n    const {\n      layer,\n      userAnswers,\n      question,\n      isCorrecting\n    } = this.state\n\n    return (\n      <Animated.View style={[{ opacity: this.state.opacityAnimation, flex: 8, alignSelf: \"stretch\" }]}>\n        <Prompt\n          ref={this.promptComponent}\n          prompt={question.prompt}\n          secondaryPrompt={question.secondaryPrompt} />\n\n        <Answer\n          isCorrecting={isCorrecting}\n          layer={layer}\n          choices={question.choices}\n          userAnswers={userAnswers} />          \n\n        <Choices\n          isInterlude={this.props.isInterlude}\n          ref={this.choicesComponent}\n          layer={layer}\n          data={question.choices}\n          guessed={this.guessed.bind(this)} />\n      </Animated.View>\n    )\n  }\n}\n"],"sourceRoot":""}